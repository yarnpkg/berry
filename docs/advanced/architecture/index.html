<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/berry/styles.ded5aee70e76278d80e9.css">*{box-sizing:border-box}body,html{height:100%;margin:0;padding:0;font-family:Open Sans;line-height:1.5}code{font-family:PT Mono}:not(pre)>code[class*=language-]{background:transparent;padding:unset}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.7.1"/><title data-react-helmet="true"></title><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/abel/v9/MwQ5bhbm2POE2V9BPQ.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/baumans/v8/-W_-XJj9QyTd3Qfpd_04aw.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN7rgOUuhp.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN_r8OUuhp.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/opensans/v16/mem8YaGs126MiZpBA-UFVZ0b.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/berry/google-fonts/s/ptmono/v6/9oRONYoBnWILk-9AnC8zMw.woff2"/><style type="text/css">@font-face{font-family:'Open Sans';font-style:normal;font-weight:300;src:local('Open Sans Light'),local('OpenSans-Light'),url(/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN_r8OUuhp.woff2) format('woff2'),url(/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN_r8OUuhv.woff) format('woff');font-display: swap}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;src:local('Open Sans Regular'),local('OpenSans-Regular'),url(/berry/google-fonts/s/opensans/v16/mem8YaGs126MiZpBA-UFVZ0b.woff2) format('woff2'),url(/berry/google-fonts/s/opensans/v16/mem8YaGs126MiZpBA-UFVZ0d.woff) format('woff');font-display: swap}@font-face{font-family:'Open Sans';font-style:normal;font-weight:700;src:local('Open Sans Bold'),local('OpenSans-Bold'),url(/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN7rgOUuhp.woff2) format('woff2'),url(/berry/google-fonts/s/opensans/v16/mem5YaGs126MiZpBA-UN7rgOUuhv.woff) format('woff');font-display: swap}@font-face{font-family:Abel;font-style:normal;font-weight:400;src:local('Abel Regular'),local('Abel-Regular'),url(/berry/google-fonts/s/abel/v9/MwQ5bhbm2POE2V9BPQ.woff2) format('woff2'),url(/berry/google-fonts/s/abel/v9/MwQ5bhbm2POE2V9BOw.woff) format('woff');font-display: swap}@font-face{font-family:Baumans;font-style:normal;font-weight:400;src:local('Baumans Regular'),local('Baumans-Regular'),url(/berry/google-fonts/s/baumans/v8/-W_-XJj9QyTd3Qfpd_04aw.woff2) format('woff2'),url(/berry/google-fonts/s/baumans/v8/-W_-XJj9QyTd3Qfpd_04bQ.woff) format('woff');font-display: swap}@font-face{font-family:'PT Mono';font-style:normal;font-weight:400;src:local('PT Mono'),local('PTMono-Regular'),url(/berry/google-fonts/s/ptmono/v6/9oRONYoBnWILk-9AnC8zMw.woff2) format('woff2'),url(/berry/google-fonts/s/ptmono/v6/9oRONYoBnWILk-9AnC8zNQ.woff) format('woff');font-display: swap}</style><link rel="shortcut icon" href="/berry/icons/icon-48x48.png"/><link rel="manifest" href="/berry/manifest.webmanifest"/><meta name="theme-color" content="#2188b6"/><link rel="apple-touch-icon" sizes="48x48" href="/berry/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/berry/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/berry/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/berry/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/berry/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/berry/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/berry/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/berry/icons/icon-512x512.png"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/berry/styles-33bb4e0c7191f87f28e5.js"/><link as="script" rel="preload" href="/berry/component---src-templates-article-js-fe7627bfc46364e5ce39.js"/><link as="script" rel="preload" href="/berry/2-c79c937529a89d1dc668.js"/><link as="script" rel="preload" href="/berry/1-6b574e676df0cbff0b46.js"/><link as="script" rel="preload" href="/berry/app-32972a8af6f4c1380030.js"/><link as="script" rel="preload" href="/berry/webpack-runtime-0343150c08ac61cee6d3.js"/><link as="fetch" rel="preload" href="/berry/static/d/768/path---advanced-architecture-4-da-48b-XcX0OYr9hMKbj1GBfOV3AhnoZTI.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="3fu4ya">@media (min-width:601px){.css-3fu4ya{position:-webkit-sticky;position:sticky;top:0;z-index:1;}}</style><div class="css-3fu4ya e1e22q4b0"><style data-emotion-css="14wzgec">.css-14wzgec{display:block;padding:0.8em 1em;font-weight:light;-webkit-text-decoration:none;text-decoration:none;background:#2188b6;color:rgba(255,255,255,0.8);}</style><a href="https://github.com/yarnpkg/berry" class="css-14wzgec e1e22q4b1"><style data-emotion-css="ol3iif">.css-ol3iif{font-weight:bold;color:#ffffff;}</style><span class="css-ol3iif e1e22q4b2">Important:</span> This documentation covers the v2 onwards and is actively being worked on. Come help us!</a><style data-emotion-css="afjtw6">.css-afjtw6{background:#ffffff;}@media (min-width:601px){.css-afjtw6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><header class="css-afjtw6 e1e22q4b3"><style data-emotion-css="k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="css-k008qs e1e22q4b4"><style data-emotion-css="rmb94o">.css-rmb94o{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 1em;}@media (max-width:600px){.css-rmb94o{margin-right:auto;padding:1em;}}</style><a class="css-rmb94o e1e22q4b5" href="/berry/"><img alt="Yarn" src="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTE1NC44IDUxOCI+PHN0eWxlPi5zdDB7ZmlsbDojMmM4ZWJifS5zdDF7ZmlsbDojZmZmfTwvc3R5bGU+PHBhdGggY2xhc3M9InN0MCIgZD0iTTcxOC42IDI1Ny44Yy04IDI3LjYtMjAuOCA0Ny42LTM1LjIgNjMuNlYxODFjMC05LjYtOC40LTE3LjYtMjEuNi0xNy42LTUuNiAwLTEwLjQgMi44LTEwLjQgNi44IDAgMi44IDEuNiA1LjIgMS42IDEyLjh2NjQuNGMtNC44IDI4LTE2LjggNTQtMzIuOCA1NC0xMS42IDAtMTguNC0xMS42LTE4LjQtMzMuMiAwLTMzLjYgNC40LTUxLjIgMTEuNi04MC44IDEuNi02IDEzLjItMjItNi40LTIyLTIxLjIgMC0xOC40IDgtMjEuMiAxNC44IDAgMC0xMy40IDQ3LjYtMTMuNCA5MCAwIDM0LjggMTQuNiA1Ny42IDQxLjQgNTcuNiAxNy4yIDAgMjkuNi0xMS42IDM5LjItMjcuNlYzNTFjLTI2LjQgMjMuMi00OS42IDQzLjYtNDkuNiA4NCAwIDI1LjYgMTYgNDYgMzguNCA0NiAyMC40IDAgNDEuNi0xNC44IDQxLjYtNTYuOFYzNTVjMjEuNi0xOC44IDQ0LjgtNDIuNCA1OC40LTg4LjguNC0xLjYuNC0zLjYuNC00IDAtNy42LTcuNi0xNi40LTE0LTE2LjQtNCAwLTcuMiAzLjYtOS42IDEyem0tNzYuOCAxOThjLTYuNCAwLTEwLjQtOS42LTEwLjQtMjIgMC0yNCA4LjgtMzkuMiAyMS42LTUyLjR2NDIuOGMwIDcuNiAxLjYgMzEuNi0xMS4yIDMxLjZ6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTgzMy40IDMwMWMtOS42IDAtMTMuNi05LjYtMTMuNi0xOC40di02NmMwLTkuNi04LjQtMTcuNi0yMS42LTE3LjYtNS42IDAtMTAuNCAyLjgtMTAuNCA2LjggMCAyLjggMS42IDUuMiAxLjYgMTIuOHY2MS42Qzc4NSAyOTEuNCA3NzcuOCAzMDEgNzY3IDMwMWMtMTQgMC0yMi44LTEyLTIyLjgtMzIuOCAwLTU3LjYgMzUuNi04My42IDY2LTgzLjYgNCAwIDggLjggMTEuNi44IDQgMCA1LjItMi40IDUuMi05LjIgMC0xMC40LTcuNi0xNi44LTE4LjQtMTYuOC00OC44IDAtOTUuMiA0MC44LTk1LjIgMTA3LjYgMCAzNCAxNi40IDYwLjQgNDcuNiA2MC40IDE1LjIgMCAyNi40LTcuMiAzNC40LTE2LjQgNiA5LjYgMTYuOCAxNi40IDMwLjggMTYuNCAzNC40IDAgNTAuNC0zNiA1Ny4yLTYyLjQuNC0xLjYuNC0yLjQuNC0yLjggMC03LjYtNy42LTE2LjQtMTQtMTYuNC00IDAtOCAzLjYtOS42IDEyLTMuNiAxNy42LTEwLjggNDMuMi0yNi44IDQzLjJ6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTk0OSAzMjcuNGMzNC40IDAgNTAtMzYgNTcuMi02Mi40IDAtLjguNC0xLjYuNC0yLjggMC03LjYtNy42LTE2LjQtMTQtMTYuNC00IDAtOCAzLjYtOS42IDEyLTMuNiAxNy42LTEwLjQgNDMuMi0yOC44IDQzLjItMTAuOCAwLTE2LTEwLjQtMTYtMjEuNiAwLTQwIDE4LTg3LjIgMTgtOTIgMS42LTkuMi0xNC40LTIyLjQtMTkuMi0yMi40aC0yMC44Yy00IDAtOCAwLTIxLjItMS42LTQuNC0xNi40LTE1LjYtMjEuMi0yNS4yLTIxLjItMTAuNCAwLTIwIDcuMi0yMCAxOC40IDAgMTEuNiA3LjIgMjAgMTcuMiAyNS42LS40IDIwLjQtMiA1My42LTYuNCA2OS42LTMuNiAxMy42IDE3LjIgMjggMjIuNCAxMS4yIDcuMi0yMy4yIDkuNi01OCAxMC03My42aDM0LjhjLTEyLjggMzQuNC0yMCA2Mi44LTIwIDg4LjQgMCAzNS4yIDIyLjQgNDUuNiA0MS4yIDQ1LjZ6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTk4NC42IDMwOS44YzAgMTQuOCAxMS4yIDE3LjYgMTkuMiAxNy42IDExLjYgMCAxMS4yLTkuNiAxMS4yLTE3LjJ2LTU4LjRjMi44LTMxLjYgMjcuNi02NiAzOS4yLTY2IDcuNiAwIDguNCAxMC40IDguNCAyMi44djgxLjJjMCAyMC40IDEyLjQgMzcuNiAzMy42IDM3LjYgMzQuNCAwIDUxLjQtMzYgNTguMi02Mi40LjQtMS42LjQtMi40LjQtMi44IDAtNy42LTcuNi0xNi40LTE0LTE2LjQtNCAwLTggMy42LTkuNiAxMi0zLjYgMTcuNi0xMS44IDQzLjItMjcuOCA0My4yLTEwLjQgMC0xMC40LTE0LjgtMTAuNC0xOC40di04Mi44YzAtMTguNC02LjQtNDAuNC0zMy4yLTQwLjQtMTkuNiAwLTM0IDE3LjItNDQuOCAzOS42di0xOGMwLTkuNi04LjQtMTcuNi0yMS42LTE3LjYtNS42IDAtMTAuNCAyLjgtMTAuNCA2LjggMCAyLjggMS42IDUuMiAxLjYgMTIuOHYxMjYuOHpNMjU5IDBjMTQzIDAgMjU5IDExNiAyNTkgMjU5UzQwMiA1MTggMjU5IDUxOCAwIDQwMiAwIDI1OSAxMTYgMCAyNTkgMHoiLz48cGF0aCBjbGFzcz0ic3QxIiBkPSJNNDM1LjIgMzM3LjVjLTEuOC0xNC4yLTEzLjgtMjQtMjkuMi0yMy44LTIzIC4zLTQyLjMgMTIuMi01NS4xIDIwLjEtNSAzLjEtOS4zIDUuNC0xMyA3LjEuOC0xMS42LjEtMjYuOC01LjktNDMuNS03LjMtMjAtMTcuMS0zMi4zLTI0LjEtMzkuNCA4LjEtMTEuOCAxOS4yLTI5IDI0LjQtNTUuNiA0LjUtMjIuNyAzLjEtNTgtNy4yLTc3LjgtMi4xLTQtNS42LTYuOS0xMC04LjEtMS44LS41LTUuMi0xLjUtMTEuOS40QzI5My4xIDk2IDI4OS42IDkzLjggMjg2LjkgOTJjLTUuNi0zLjYtMTIuMi00LjQtMTguNC0yLjEtOC4zIDMtMTUuNCAxMS0yMi4xIDI1LjItMSAyLjEtMS45IDQuMS0yLjcgNi4xLTEyLjcuOS0zMi43IDUuNS00OS42IDIzLjgtMi4xIDIuMy02LjIgNC0xMC41IDUuNmguMWMtOC44IDMuMS0xMi44IDEwLjMtMTcuNyAyMy4zLTYuOCAxOC4yLjIgMzYuMSA3LjEgNDcuNy05LjQgOC40LTIxLjkgMjEuOC0yOC41IDM3LjUtOC4yIDE5LjQtOS4xIDM4LjQtOC44IDQ4LjctNyA3LjQtMTcuOCAyMS4zLTE5IDM2LjktMS42IDIxLjggNi4zIDM2LjYgOS44IDQyIDEgMS42IDIuMSAyLjkgMy4zIDQuMi0uNCAyLjctLjUgNS42LjEgOC42IDEuMyA3IDUuNyAxMi43IDEyLjQgMTYuMyAxMy4yIDcgMzEuNiAxMCA0NS44IDIuOSA1LjEgNS40IDE0LjQgMTAuNiAzMS4zIDEwLjZoMWM0LjMgMCA1OC45LTIuOSA3NC44LTYuOCA3LjEtMS43IDEyLTQuNyAxNS4yLTcuNCAxMC4yLTMuMiAzOC40LTEyLjggNjUtMzAgMTguOC0xMi4yIDI1LjMtMTQuOCAzOS4zLTE4LjIgMTMuNi0zLjMgMjIuMS0xNS43IDIwLjQtMjkuNHptLTIzLjggMTQuN2MtMTYgMy44LTI0LjEgNy4zLTQzLjkgMjAuMi0zMC45IDIwLTY0LjcgMjkuMy02NC43IDI5LjNzLTIuOCA0LjItMTAuOSA2LjFjLTE0IDMuNC02Ni43IDYuMy03MS41IDYuNC0xMi45LjEtMjAuOC0zLjMtMjMtOC42LTYuNy0xNiA5LjYtMjMgOS42LTIzcy0zLjYtMi4yLTUuNy00LjJjLTEuOS0xLjktMy45LTUuNy00LjUtNC4zLTIuNSA2LjEtMy44IDIxLTEwLjUgMjcuNy05LjIgOS4zLTI2LjYgNi4yLTM2LjkuOC0xMS4zLTYgLjgtMjAuMS44LTIwLjFzLTYuMSAzLjYtMTEtMy44Yy00LjQtNi44LTguNS0xOC40LTcuNC0zMi43IDEuMi0xNi4zIDE5LjQtMzIuMSAxOS40LTMyLjFzLTMuMi0yNC4xIDcuMy00OC44YzkuNS0yMi41IDM1LjEtNDAuNiAzNS4xLTQwLjZzLTIxLjUtMjMuOC0xMy41LTQ1LjJjNS4yLTE0IDcuMy0xMy45IDktMTQuNSA2LTIuMyAxMS44LTQuOCAxNi4xLTkuNSAyMS41LTIzLjIgNDguOS0xOC44IDQ4LjktMTguOHMxMy0zOS41IDI1LTMxLjhjMy43IDIuNCAxNyAzMiAxNyAzMnMxNC4yLTguMyAxNS44LTUuMmM4LjYgMTYuNyA5LjYgNDguNiA1LjggNjgtNi40IDMyLTIyLjQgNDkuMi0yOC44IDYwLTEuNSAyLjUgMTcuMiAxMC40IDI5IDQzLjEgMTAuOSAyOS45IDEuMiA1NSAyLjkgNTcuOC4zLjUuNC43LjQuN3MxMi41IDEgMzcuNi0xNC41YzEzLjQtOC4zIDI5LjMtMTcuNiA0Ny40LTE3LjggMTcuNS0uMyAxOC40IDIwLjIgNS4yIDIzLjR6Ii8+PC9zdmc+" style="height:3em;vertical-align:middle"/></a><style data-emotion-css="w60let">.css-w60let{margin:1em;margin-left:0;border:1px solid lightgrey;border-radius:10px;width:3em;height:3em;font-size:inherit;background:#ffffff;}@media (min-width:601px){.css-w60let{display:none;}}</style><button class="css-w60let e1e22q4b6">â‰¡</button></div><style data-emotion-css="136322t">.css-136322t{background:#ffffff;}@media (min-width:601px){.css-136322t{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (max-width:600px){.css-136322t{position:absolute;z-index:1;width:100%;-webkit-transform:scaleY(0);-ms-transform:scaleY(0);transform:scaleY(0);-webkit-transform-origin:top left;-ms-transform-origin:top left;transform-origin:top left;-webkit-transition:-webkit-transform .3s;-webkit-transition:transform .3s;transition:transform .3s;}.css-136322t.expanded{-webkit-transform:scaleY(1);-ms-transform:scaleY(1);transform:scaleY(1);}}</style><div class=" css-136322t e1e22q4b7"><style data-emotion-css="1s1x8cq">.css-1s1x8cq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:4em;border:3px solid transparent;padding:0 1em;font-family:Abel;font-weight:light;-webkit-text-decoration:none;text-decoration:none;text-transform:uppercase;color:#000000;}@media (min-width:601px){.css-1s1x8cq.active{border-bottom-color:#2188b6;}}@media (max-width:600px){.css-1s1x8cq{width:100%;}}</style><a class="css-1s1x8cq e1e22q4b8" href="/berry/">Home</a><a class="css-1s1x8cq e1e22q4b8" href="/berry/getting-started">Getting started</a><a class="css-1s1x8cq e1e22q4b8" href="/berry/configuration">Configuration</a><a class="css-1s1x8cq e1e22q4b8" href="/berry/features">Features</a><a class="css-1s1x8cq e1e22q4b8" href="/berry/cli/install">CLI</a><a aria-current="page" class="css-1s1x8cq e1e22q4b8 active" href="/berry/advanced/architecture">Advanced</a></div></header></div><main><style data-emotion-css="w837w5">.css-w837w5{position:relative;}@media (min-width:601px){.css-w837w5{padding-left:300px;}}</style><div class="css-w837w5 e136yufg0"><style data-emotion-css="1m2g9kf">@media (min-width:601px){.css-1m2g9kf{position:fixed;left:0;width:300px;height:calc(100vh - 4em);overflow-y:auto;background:#d1dee8;}}</style><div class="css-1m2g9kf e136yufg1"><style data-emotion-css="1srnx9y">.css-1srnx9y{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:1px solid #cfdee9;padding:1.5em;-webkit-text-decoration:none;text-decoration:none;background:#ffffff;color:#333333;}.css-1srnx9y:first-of-type{border-top:1px solid #cfdee9;}.css-1srnx9y::before{content:"";position:absolute;z-index:1;top:-1px;bottom:-1px;right:0;width:5px;background:#cfdee9;}.css-1srnx9y.active::before{background:#2188b6;}</style><a aria-current="page" class="css-1srnx9y e136yufg2 active" href="/berry/advanced/architecture">Architecture</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/contributing">Contributing</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/error-codes">Error Codes</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/lexicon">Lexicon</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/migration">Migration</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/peer-dependencies">Peer Dependencies</a><a class="css-1srnx9y e136yufg2" href="/berry/advanced/pnpify">PnPify</a></div><style data-emotion-css="rnvzr0">.css-rnvzr0 > *{overflow:auto;}</style><div class="css-rnvzr0 e136yufg3"><style data-emotion-css="2aowkf">.css-2aowkf{padding:2em;}@media (min-width:601px){.css-2aowkf{border-top:1px solid #cfdee9;text-align:justify;}}</style><div class="css-2aowkf e15875m70"><div style="max-width:900px"><article class="css-0 ej1wll30"><style data-emotion-css="1ry8ma5">.css-1ry8ma5{box-sizing:border-box;margin:0;height:4rem;border-bottom:1px solid;font-weight:300;font-size:2rem;line-height:4rem;}.css-1ry8ma5 + div > blockquote{font-style:normal;}</style><h1 class="css-1ry8ma5 ej1wll31">Architecture</h1><style data-emotion-css="1qnhlud">.css-1qnhlud blockquote{margin-left:0;border-left:3px solid #859daf;padding-left:.5em;font-style:italic;color:#859daf;}.css-1qnhlud a:not(.anchor){border-bottom:1px solid;-webkit-text-decoration:none;text-decoration:none;color:#007aa2;}.css-1qnhlud a:not(.anchor):hover{color:#62b0ca;}.css-1qnhlud p,.css-1qnhlud table{margin-bottom:1em;}.css-1qnhlud table{width:100%;border-collapse:collapse;}.css-1qnhlud th{color:#007aa2;}.css-1qnhlud th,.css-1qnhlud td{border:1px solid #007aa2;padding:.5em 1em;}.css-1qnhlud h1{margin-top:0;}.css-1qnhlud h2,.css-1qnhlud h3,.css-1qnhlud h4{border-bottom:1px solid #d1dee8;padding-bottom:0.2em;font-weight:300;}.css-1qnhlud pre{padding:1em;overflow-x:auto;background:#242424;}.css-1qnhlud code{display:inline-block;text-align:left;color:#007aa2;}.css-1qnhlud pre code{color:#ddddcc;}</style><div class="css-1qnhlud ej1wll32"><h2 id="general-architecture"><a href="#general-architecture" aria-label="general architecture permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>General architecture</h2>
<p>Yarn works through a core package (published as <code class="language-text">@berry/core</code>) that exposes the various base components that make up a project. Some of components are classes that you might recognize from the API: <code class="language-text">Configuration</code>, <code class="language-text">Project</code>, <code class="language-text">Workspace</code>, <code class="language-text">Cache</code>, <code class="language-text">Manifest</code>, and others. All those are provided by the core package.</p>
<p>The core itself doesn't do much - it merely contains the logic required to manage a project. In order to use this logic from the command-line Yarn provides an indirection called <code class="language-text">@berry/cli</code> which, interestingly, doesn't do much either. It however has two very important responsibilities: it hydrates a project instance based on the current directory (<code class="language-text">cwd</code>), and inject the prebuilt Yarn plugins into the environment.</p>
<p>See, Yarn is built in modular way that allow most of the business logic related to third-party interactions to be externalized inside their own package - for example the <a href="https://github.com/yarnpkg/berry/tree/master/packages/plugin-npm">npm resolver</a> is but one plugin amongst many others. This design gives us a much simpler codebase to work with (hence an increased development speed and stabler product), and offers plugin authors the ability to write their own external logic without having to modify the Yarn codebase itself.</p>
<h2 id="install-architecture"><a href="#install-architecture" aria-label="install architecture permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install architecture</h2>
<p>What happens when running <code class="language-text">yarn install</code> can be summarized in a few different steps:</p>
<ol>
<li>
<p>First we enter the "resolution step":</p>
<ul>
<li>
<p>First we load the entries stored within the lockfile, then based on those data and the current state of the project (that it figures out by reading the manifest files, aka <code class="language-text">package.json</code>) the core runs an internal algorithm to find out which entries are missing.</p>
</li>
<li>
<p>For each of those missing entries, it queries the plugins using the <a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Resolver.ts"><code class="language-text">Resolver</code></a> interface, and asks them whether they would know about a package that would match the given descriptor (<a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Resolver.ts#L52"><code class="language-text">supportsDescriptor</code></a>) and its exact identity (<a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Resolver.ts#L112"><code class="language-text">getCandidates</code></a>) and transitive dependency list (<a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Resolver.ts#L121"><code class="language-text">resolve</code></a>).</p>
</li>
<li>
<p>Once it has obtained a new list of package metadata, the core starts a new resolution pass on the transitive dependencies of the newly added packages. This will be repeated until it figures out that all packages from the dependency tree now have their metadata stored within the lockfile.</p>
</li>
<li>
<p>Finally, once every package range from the dependency tree has been resolved into metadata, the core builds the tree in memory one last time in order to generate what we call "virtual packages". In short those virtual packages are split instances of a same base package - we use them to disambiguate all packages that list peer dependencies, whose dependency set would change depending on their location in the dependency tree (consult <a href="/berry/advanced/peer-dependencies">this advanced article</a> for more information).</p>
</li>
</ul>
</li>
<li>
<p>Once the resolution is done, we enter the "fetch step":</p>
<ul>
<li>
<p>Now that we have the exact set of packages that make up our dependency tree, we iterate over it and for each of them we start a new request to the cache to know whether the package if anywhere to be found. If it isn't we do just like we did in the previous step and we ask our plugins (through the <a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Fetcher.ts"><code class="language-text">Fetcher</code></a> interface) whether they know about the package (<a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Fetcher.ts#L43"><code class="language-text">supports</code></a>) and if so to retrieve it from whatever its remote location is (<a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Fetcher.ts#L67"><code class="language-text">fetch</code></a>).</p>
</li>
<li>
<p>Interesting tidbit regarding the fetchers: they communicate with the core through an abstraction layer over <code class="language-text">fs</code>. We do this so that our packages can come from many different sources - it can be from a zip archive for packages downloaded from a registry, or from an actual directory on the disk for <a href=""><code class="language-text">portal:</code></a> dependencies.</p>
</li>
</ul>
</li>
<li>
<p>And finally, once all the packages are ready for consumption, comes the "link step":</p>
<ul>
<li>
<p>In order to work properly, the packages you use must be installed on the disk in some way. For example, in the case of a native Node application, your packages would have to be installed into a set of <code class="language-text">node_modules</code> directories so that they could be located by the interpreter. That's what the linker is about. Through the <a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Linker.ts"><code class="language-text">Linker</code></a> and <a href="https://github.com/yarnpkg/berry/blob/master/packages/berry-core/sources/Installer.ts"><code class="language-text">Installer</code></a> interfaces the Yarn core will communicate with the registered plugins to let them know about the packages listed in the dependency tree, and describe their relationships (for example it would tell them that <code class="language-text">tapable</code> is a dependency of <code class="language-text">webpack</code>). The plugins can then decide what to do of these information in whatever they see fit.</p>
</li>
<li>
<p>Doing this means that new linkers can be created for other programming languages pretty easily - you just need to write your own logic regarding what should happen from the packages provided by Yarn. Want to generate an <code class="language-text">__autoload.php</code>? Do it! Want to setup a Python virtual env? No problemo!</p>
</li>
<li>
<p>Something else that's pretty cool is that the packages from within the dependency tree don't have to all be of the same type. Our plugin design allows instantiating multiple linkers simultaneously. Even better - the packages can depend on one another across linkers! You could have a JavaScript package depending on a Python package (which is technically the case of <code class="language-text">node-gyp</code>, for example).</p>
</li>
</ul>
</li>
</ol></div></article></div></div></div></div></main></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-article-js","jsonName":"advanced-architecture-4da","path":"/advanced/architecture"};window.dataPath="768/path---advanced-architecture-4-da-48b-XcX0OYr9hMKbj1GBfOV3AhnoZTI";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-32972a8af6f4c1380030.js"],"component---src-templates-article-js":["/component---src-templates-article-js-fe7627bfc46364e5ce39.js"],"component---src-pages-index-js":["/component---src-pages-index-js-17467937177c835ff9f1.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c0fb5d895e5a3fa4f9f4.js"],"component---src-pages-configuration-manifest-js":["/component---src-pages-configuration-manifest-js-ac3806f1d6cafd20e7d3.js"],"component---src-pages-configuration-yarnrc-js":["/component---src-pages-configuration-yarnrc-js-2221f01b4126e3357893.js"],"component---src-pages-package-js":["/component---src-pages-package-js-4067fd5f9d849625301e.js"],"pages-manifest":["/pages-manifest-248fb8983edc7c498f37.js"]};/*]]>*/</script><script src="/berry/webpack-runtime-0343150c08ac61cee6d3.js" async=""></script><script src="/berry/app-32972a8af6f4c1380030.js" async=""></script><script src="/berry/1-6b574e676df0cbff0b46.js" async=""></script><script src="/berry/2-c79c937529a89d1dc668.js" async=""></script><script src="/berry/component---src-templates-article-js-fe7627bfc46364e5ce39.js" async=""></script><script src="/berry/styles-33bb4e0c7191f87f28e5.js" async=""></script></body></html>