# Handles packaging Yarn into Debian and RPM packages
on:
  push:
    branches:
    - master
    paths:
    - scripts/actions/build-deb
    - scripts/winsetup
    - .github/workflows/package-workflow.yml
  pull_request:
    paths:
    - scripts/actions/build-deb
    - scripts/winsetup
    - .github/workflows/package-workflow.yml

name: 'Release Packages'
jobs:
  linux-packages:
    name: 'Linux Packages'
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@master

    - uses: actions/setup-node@master
      with:
        version: 12.x

    - name: 'Build the standard bundle'
      run: node ./scripts/run-yarn.js build:cli

    - name: 'Build the dist directory'
      run: ./scripts/build-dist.sh

    - name: 'Build the deb archive'
      uses: ./scripts/actions/build-deb

  windows-installer:
    name: 'Windows Installer'
    runs-on: windows-2016

    steps:
    - uses: actions/checkout@master

    - uses: actions/setup-node@master
      with:
        version: 12.x

    - name: 'Build the standard bundle'
      run: node ./scripts/run-yarn.js build:cli

    - name: 'Build the dist directory'
      run: bash ./scripts/build-dist.sh

    - name: 'Setup MSBuild'
      uses: warrenbuckley/Setup-MSBuild@1176db82e64cd53b4944f0e57c2abec104b4782d

    - name: 'Build the Windows installer'
      run: MSBuild.exe scripts\winsetup\YarnSetup.wixproj /p:Configuration=Release
      shell: cmd

    - uses: actions/upload-artifact@master
      with:
        name: windows-installer
        path: artifacts
